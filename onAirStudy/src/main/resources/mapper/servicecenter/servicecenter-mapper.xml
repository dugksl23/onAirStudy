<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="service">


<!-- 자주묻는 질문List -->
<select id="selectServiceContentList" resultMap="serviceMap">
	select *
	from service_content
</select>



<select id="listAll" resultMap="serviceListMap">
	select * 
	from service
	<include refid="search" />
	order by no desc 
</select>


<select id="totalCount" resultType="int">
	select count(*)
	from service
<!--  	<include refid="search" /> -->

 </select>



<sql id="search">
<choose>
	
          <!-- 작성자 , 내용, 제목으로 각각 검색할 수 있게끔 한다. -->
            <when test="search_option == 'all' ">	
            	where member_id like '%'||#{keyword}||'%'
                      or category like '%' || #{keyword}||'%'
                      or serviceTitle like '%'||#{keyword}||'%'  
            </when>
            <when test="category != 0">
            	where category = #{category}
            </when>
            <otherwise>
             
          <!--    작성자 + 내용 + 제목을 포함한 항목을 검색할 수 있게끔 한다. -->
                where ${search_option} like '%'||#{keyword}||'%'
            </otherwise>
</choose>
</sql> 




<resultMap type="map" id="serviceMap">
	<id column="no" property="no"/>	
	<result column="category" property="category"/>
	<result column="title" property="title"/>
	<result column="content" property="content"/>

</resultMap>


 
 <select id="selectServiceList" resultMap="serviceListMap">
 	<![CDATA[
 		select * 
 		from (select /* + INDEX_DESC(service) */ 
 			  rownum rn, no, category, service_title, service_status, service_date, service_content, member_id
 			  from service where rownum <= #{pageNum} * #{amount})
 		where rn > (#{pageNum} - 1) * #{amount}
 		order by no desc
 	]]>
</select>


 
<insert id="insertService">

	insert into 
		service 
	values(
	seq_service_no.nextval, 
		#{category},  
		default, 
		#{serviceTitle}, 
		#{serviceContent},
		null, 
		#{memberId}, 
		default, 
		default, 
		default
	)
</insert>



<select id="serviceDetail" resultType="map">
select
	*
from 
	service
where
	no = #{no}
</select>
	





<resultMap type="map" id="serviceListMap">
	
	<result column="no" property="no"/>
	<result column="category" property="category"/>
	<result column="service_status" property="serviceStatus"/>
	<result column="service_title" property="serviceTitle"/>
	<result column="service_content" property="serviceContent"/>
	<result column="reply_no" property="reply_no"/>
	<result column="member_id" property="memberId"/>
	<result column="service_date" property="serviceDate"/>
	<result column="read_yn" property="read_yn"/>
	<result column="service_level" property="serviceLevel"/>

</resultMap>





</mapper>